syntax = "proto3";

package operator.v1.cluster;

option go_package = "github.com/megakuul/miam/pkg/api/operator/v1/cluster";

// dynamodb design:
// partkey -> project name
// sortkey -> revision
// gsi.partkey -> revision (list latest revision)
// gsi.sortkey -> project name

enum State {
  ACTIVE = 0;
  INACTIVE = 1;
  DEPLOYING = 2;
  FAILED = 3;
}

message ClusterStatus {
  string name = 1;
  string revision = 2;
  repeated string tags = 3;
  State state = 4;
  string error = 5;
}

message ClusterConfig {
  string repo_url = 2;
  string repo_ref = 3;
  
  InstanceConfig control_config = 4;
  InstanceConfig worker_config = 5;
}

message InstanceConfig {
  string type = 1;
  int64 min_scale = 2;
  int64 max_scale = 3;
}

message ListRequest {
}

message ListResponse {
  repeated ClusterStatus clusters = 1; // returns latest revision of all clusters
}

message GetRequest {
  string name = 1;
}

message GetResponse {
  repeated ClusterStatus revisions = 1; // returns all revisions of one cluster 
}

message DescribeRequest {
  string name = 1;
  string revision = 2;
}

message DescribeResponse {
  ClusterConfig config = 1;
}

message UpdateRequest {
  ClusterConfig config = 1;
}

message UpdateResponse {
  string revision = 1;
}

message DestroyRequest {
  string name = 1;
}

message DestroyResponse {
}
